#!/bin/bash
set -e
export WINEPREFIX=/games/battle.net
export WINEDEBUG=-all
export DXVK_LOG_LEVEL=none
export VKD3D_DEBUG=none
export VKD3D_SHADER_DEBUG=none
export ENABLE_HDR_WSI=1
export DXVK_HDR=1
trap "bnet k" SIGINT SIGTERM

cd "$WINEPREFIX/drive_c"

if [ "$1" = "tsm" ]; then
	cd tsm
	wine ./app/TSMApplication.exe

elif [ "$1" = "logs" ]; then
	./warcraftlogs*.appimage

elif [ "$1" = "wt" ]; then
	shift
	winetricks "$@"

elif [ "$1" = "w" ]; then
	shift
	"$@"

elif [ "$1" = "r" ]; then
	cd "Program Files (x86)/Battle.net"
	bnet tsm &
	wine Battle.net.exe
	wineserver -w

elif [ "$1" = "k" ]; then
	wineserver -k
	pkill -9 gamescope-wl

else
	gamescope --hdr-enabled -W 2560 -H 1440 --adaptive-sync -b -- game-performance bnet r &>/dev/null
fi
